import{k as N,l as O,m as g,n as Q,p as G,c as H,q as J,g as K,a as $,o as I,b as t,d as a,s as W,w as i,v as X,f as y,x as U,t as p,e as Y,y as M,z as Z,A as ee}from"./index-BgBSlF4g.js";import{s as se,a as te,b as le,c as oe}from"./index-CQo5VGv2.js";import{s as ae}from"./index-B0wFmsZq.js";import{b as w}from"./blogs-DZIwB8Q4.js";import{b as P}from"./route-block-B_A1xBdJ.js";import"./index-BaPogHvy.js";const re={class:"space-y-6"},ie={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ne={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-center"},de={class:"flex-1"},ue={class:"p-input-icon-left w-full"},me={class:"sm:w-48"},ce={class:"font-medium line-clamp-2"},ge={class:"w-80 truncate"},pe=["src","onClick"],fe={class:"flex items-center gap-2"},ve={class:"flex gap-2"},be={class:"rounded-xl bg-white/60 backdrop-blur p-4 space-y-4"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},we={class:"col-span-1 md:col-span-2"},xe={class:"col-span-1 md:col-span-2"},_e={class:"col-span-1 md:col-span-2"},he={class:"col-span-1 md:col-span-2"},Ve={class:"col-span-1 md:col-span-2"},ke={class:"flex items-center gap-3"},Ce={class:"w-full flex items-center justify-between gap-3"},Le={__name:"blog",setup($e){N();const n=O(),h=g([]),x=g(!1),f=g(""),v=g(null),m=g(!1),c=g(null),o=Q({title:"",summary:"",content:"",coverImage:"",tags:"",author:"",visible:!0}),V=[{label:"職訓局環境",value:"職訓局環境"},{label:"甄試相關",value:"甄試相關"},{label:"課程相關",value:"課程相關"},{label:"訓練期間相關規則",value:"訓練期間相關規則"},{label:"職訓相關補助",value:"職訓相關補助"},{label:"學員心得",value:"學員心得"}];G(()=>{k()});const B=H(()=>{let l=h.value;if(f.value){const e=f.value.toLowerCase();l=l.filter(r=>(r.title||"").toLowerCase().includes(e)||(r.summary||"").toLowerCase().includes(e)||(r.tags||"").toLowerCase().includes(e)||(r.author||"").toLowerCase().includes(e))}return v.value!==null&&(l=l.filter(e=>e.tags===v.value)),[...l].sort((e,r)=>new Date(r.createdAt)-new Date(e.createdAt))});J(m,l=>{l||C()});const D=()=>{c.value=null,C(),m.value=!0},k=async()=>{x.value=!0;try{const{data:l}=await w.getAll();if(l.success)h.value=l.blogs;else throw new Error(l.message||"取得部落格資料失敗")}catch(l){const e=l.response?.data?.message||l.message||"無法取得部落格資料";n.add({severity:"error",summary:"錯誤",detail:e,life:3e3})}finally{x.value=!1}},A=l=>l?"success":"secondary",C=()=>{Object.assign(o,{title:"",summary:"",content:"",coverImage:"",tags:"",author:"",visible:!0})},R=l=>{l.coverImage&&window.open(l.coverImage,"_blank","noopener,noreferrer")},T=l=>{c.value=l,Object.assign(o,{...l}),m.value=!0},j=async()=>{if(!o.title?.trim()||!o.summary?.trim()||!o.tags?.trim()||!o.content?.trim()){n.add({severity:"warn",summary:"資料不足",detail:"請填寫所有必填欄位",life:2500});return}const l=e=>{try{return new URL(e),!0}catch{return!1}};if(o.coverImage&&!l(o.coverImage)){n.add({severity:"warn",summary:"格式錯誤",detail:"請提供正確的圖片網址格式",life:2500});return}if((o.title?.length||0)>200){n.add({severity:"warn",summary:"字數過長",detail:"標題最多 200 字",life:2500});return}if((o.summary?.length||0)>300){n.add({severity:"warn",summary:"字數過長",detail:"摘要最多 300 字",life:2500});return}try{if(c.value?._id){const{data:e}=await w.update(c.value._id,{...o});if(!e.success)throw new Error(e.message||"更新部落格失敗");n.add({severity:"success",summary:"更新成功",detail:`部落格「${o.title||"未命名"}」已更新`,life:3e3})}else{const{data:e}=await w.create({...o});if(!e.success)throw new Error(e.message||"新增部落格失敗");n.add({severity:"success",summary:"新增成功",detail:`部落格「${o.title||"未命名"}」已新增`,life:3e3})}m.value=!1,await k()}catch(e){const r=e.response?.data?.message||e.message||"操作失敗";n.add({severity:"error",summary:"儲存失敗",detail:r,life:3e3})}},q=async(l,e)=>{const r=l.visible;l.visible=e;try{const{data:d}=await w.update(l._id,{visible:e});if(!d.success)throw new Error(d.message||"更新狀態失敗");n.add({severity:"success",summary:"狀態已更新",detail:`「${l.title}」已${e?"上架":"下架"}`,life:2e3})}catch(d){l.visible=r;const b=d.response?.data?.message||d.message||"更新狀態失敗";n.add({severity:"error",summary:"更新失敗",detail:b,life:3e3})}};return(l,e)=>{const r=W,d=X,b=ae,u=te,z=le,E=se,L=oe,F=ee,S=K("ConfirmDialog");return I(),$("div",re,[t("div",ie,[e[12]||(e[12]=t("div",{class:"flex-1"},[t("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900"},"部落格文章內容管理"),t("p",{class:"text-sm sm:text-base text-gray-600 mt-1 sm:mt-2"},"管理所有部落格項目")],-1)),a(r,{label:"新增文章",icon:"pi pi-plus",severity:"primary",onClick:e[0]||(e[0]=s=>D()),id:"newModuleButton",size:"small",class:"w-full sm:w-auto"})]),a(b,{class:"shadow-sm"},{content:i(()=>[t("div",ne,[t("div",de,[e[13]||(e[13]=t("label",{for:"searchModules",class:"sr-only"},"搜尋文章",-1)),t("span",ue,[a(d,{id:"searchModules",name:"searchModules",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),modelModifiers:{trim:!0},placeholder:"搜尋標題、描述、分類...",class:"w-full"},null,8,["modelValue"])])]),t("div",me,[a(y(U),{id:"categoryFilter",name:"categoryFilter",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=s=>v.value=s),options:V,optionLabel:"label",optionValue:"value",placeholder:"選擇分類",showClear:"",class:"w-full"},null,8,["modelValue"])])])]),_:1}),a(b,{class:"shadow-sm"},{content:i(()=>[a(E,{loading:x.value,value:B.value,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"顯示第 {first} 到 {last} 項，共 {totalRecords} 項",responsiveLayout:"scroll",class:"p-datatable-sm"},{default:i(()=>[a(u,{field:"title",header:"標題",sortable:""},{body:i(({data:s})=>[t("div",ce,p(s.title),1)]),_:1}),a(u,{field:"summary",header:"摘要",sortable:""},{body:i(({data:s})=>[t("p",ge,p(s.summary),1)]),_:1}),a(u,{field:"tags",header:"分類",sortable:""},{body:i(({data:s})=>[t("span",null,p(s.tags),1)]),_:1}),a(u,{field:"coverImage",header:"封面圖片",sortable:""},{body:i(({data:s})=>[s.coverImage?(I(),$("img",{key:0,src:s.coverImage,alt:"封面",class:"w-20 h-12 object-cover rounded shadow cursor-pointer",onClick:_=>R(s)},null,8,pe)):Y("",!0)]),_:1}),a(u,{field:"author",header:"作者",sortable:""},{body:i(({data:s})=>[t("span",null,p(s.author),1)]),_:1}),a(u,{field:"visible",header:"狀態",sortable:""},{body:i(({data:s})=>[t("div",fe,[a(y(M),{id:"visible",name:"visible",modelValue:s.visible,"onUpdate:modelValue":_=>q(s,_)},null,8,["modelValue","onUpdate:modelValue"]),a(z,{value:s.visible?"上架":"下架",severity:A(s.visible)},null,8,["value","severity"])])]),_:1}),a(u,{field:"createdAt",header:"建立時間",sortable:""},{body:i(({data:s})=>[t("span",null,p(new Date(s.createdAt).toLocaleString()),1)]),_:1}),a(u,{header:"操作",exportable:!1},{body:i(({data:s})=>[t("div",ve,[a(r,{icon:"pi pi-pencil",severity:"warning",text:"",size:"small",onClick:_=>T(s)},null,8,["onClick"])])]),_:1})]),_:1},8,["loading","value"])]),_:1}),a(F,{visible:m.value,"onUpdate:visible":e[11]||(e[11]=s=>m.value=s),header:c.value?"編輯部落格":"新增部落格",modal:"",class:"p-fluid w-[95vw] sm:w-[38rem] max-w-4xl",dismissableMask:!0},{footer:i(()=>[t("div",Ce,[a(r,{label:"取消",icon:"pi pi-times",text:"",class:"!px-4 !py-2",onClick:e[10]||(e[10]=s=>m.value=!1)}),a(r,{label:c.value?"更新":"新增",icon:"pi pi-check",class:"!px-5 !py-2 !bg-indigo-600 hover:!bg-indigo-700 !border-indigo-600",onClick:j},null,8,["label"])])]),default:i(()=>[t("div",be,[t("div",ye,[t("div",we,[e[14]||(e[14]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"},"標題（必填）",-1)),a(d,{id:"title",name:"title",modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=s=>o.title=s),modelModifiers:{trim:!0},maxlength:200,required:"",placeholder:"最多 200 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),t("div",null,[e[15]||(e[15]=t("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-1"},"分類（必填）",-1)),a(y(U),{id:"tags",name:"tags",modelValue:o.tags,"onUpdate:modelValue":e[4]||(e[4]=s=>o.tags=s),options:V,optionLabel:"label",optionValue:"value",required:"",placeholder:"選擇分類",class:"w-full"},null,8,["modelValue"])]),t("div",xe,[e[16]||(e[16]=t("label",{for:"coverImage",class:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1"},[t("span",null,"封面圖片網址（選填）"),t("i",{class:"pi pi-info-circle text-gray-500",title:"建議 1200×675（16:9）"})],-1)),a(d,{id:"coverImage",name:"coverImage",modelValue:o.coverImage,"onUpdate:modelValue":e[5]||(e[5]=s=>o.coverImage=s),modelModifiers:{trim:!0},type:"url",placeholder:"https://example.com/cover.jpg",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),t("div",_e,[e[17]||(e[17]=t("label",{for:"summary",class:"block text-sm font-medium text-gray-700 mb-1"},"摘要（必填）",-1)),a(L,{id:"summary",name:"summary",modelValue:o.summary,"onUpdate:modelValue":e[6]||(e[6]=s=>o.summary=s),modelModifiers:{trim:!0},rows:"2",autoResize:"",maxlength:300,required:"",placeholder:"最多 300 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),t("div",he,[e[18]||(e[18]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-1"},"內容（必填）",-1)),a(L,{id:"content",name:"content",modelValue:o.content,"onUpdate:modelValue":e[7]||(e[7]=s=>o.content=s),modelModifiers:{trim:!0},rows:"6",autoResize:"",required:"",placeholder:"請輸入部落格內容",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),t("div",null,[e[19]||(e[19]=t("label",{for:"author",class:"block text-sm font-medium text-gray-700 mb-1"},"作者（選填）",-1)),a(d,{id:"author",name:"author",modelValue:o.author,"onUpdate:modelValue":e[8]||(e[8]=s=>o.author=s),modelModifiers:{trim:!0},class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),t("div",Ve,[e[20]||(e[20]=t("label",{for:"visible",class:"block text-sm font-medium text-gray-700 mb-2"},"狀態（必填）",-1)),t("div",ke,[a(y(M),{id:"visible",name:"visible",modelValue:o.visible,"onUpdate:modelValue":e[9]||(e[9]=s=>o.visible=s)},null,8,["modelValue"]),t("span",{class:Z(["text-xs px-2 py-1 rounded-md",o.visible?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},p(o.visible?"上架":"下架"),3)])])])])]),_:1},8,["visible","header"]),a(S)])}}};typeof P=="function"&&P(Le);export{Le as default};
