import{k as R,l as j,m as p,n as S,p as N,c as I,q as G,g as H,a as J,o as K,b as l,d as a,s as W,w as n,v as X,f as v,x as F,t as f,y as k,z as Y,A as Z}from"./index-BgBSlF4g.js";import{s as ee,a as se,b as te,c as le,d as ae}from"./index-CQo5VGv2.js";import{s as oe}from"./index-B0wFmsZq.js";import{f as w}from"./faqs-ByO1of6H.js";import{b as C}from"./route-block-B_A1xBdJ.js";import"./index-BaPogHvy.js";const re={class:"space-y-6"},ie={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ne={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-center"},de={class:"flex-1"},ue={class:"p-input-icon-left w-full"},me={class:"sm:w-48"},ce={class:"font-medium line-clamp-2"},pe={class:"w-80 truncate"},ve={class:"flex items-center gap-2"},fe={class:"flex gap-2"},ge={class:"rounded-xl bg-white/60 backdrop-blur p-4 space-y-4"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ye={class:"col-span-1 md:col-span-2"},we={class:"col-span-1 md:col-span-2"},xe={class:"col-span-1 md:col-span-2"},_e={class:"flex items-center gap-3"},Ve={class:"w-full flex items-center justify-between gap-3"},qe={__name:"faq",setup(he){R();const d=j(),_=p([]),x=p(!1),g=p(""),b=p(null),u=p(!1),m=p(null),o=S({question:"",answer:"",category:"",sortOrder:0,visible:!0}),A=[{label:"上架",value:!0},{label:"下架",value:!1}],$=[{label:"課程內容",value:"課程內容"},{label:"報名",value:"報名"},{label:"甄試",value:"甄試"},{label:"!!重要",value:"!!重要"}];N(()=>{V()});const O=I(()=>{let s=_.value;if(g.value){const e=g.value.toLowerCase();s=s.filter(r=>(r.question||"").toLowerCase().includes(e)||(r.answer||"").toLowerCase().includes(e)||(r.category||"").toLowerCase().includes(e))}return b.value!==null&&(s=s.filter(e=>e.visible===b.value)),[...s].sort((e,r)=>{const i=(e.sortOrder??0)-(r.sortOrder??0);return i!==0?i:new Date(r.createdAt)-new Date(e.createdAt)})});G(u,s=>{s||q()});const L=()=>{m.value=null,q(),u.value=!0},V=async()=>{x.value=!0;try{const{data:s}=await w.getAll();if(s.success)_.value=s.faqs;else throw new Error(s.message||"從伺服器獲取 FAQ 資料失敗")}catch(s){const e=s.response?.data?.message||s.message||"無法取得 FAQ 資料";d.add({severity:"error",summary:"錯誤",detail:e,life:3e3})}finally{x.value=!1}},P=s=>s?"success":"secondary",q=()=>{Object.assign(o,{question:"",answer:"",category:"",sortOrder:0,visible:!0})},Q=s=>{m.value=s,Object.assign(o,{...s}),u.value=!0},U=async()=>{if(!o.question?.trim()||!o.answer?.trim()||!o.category?.trim()){d.add({severity:"warn",summary:"資料不足",detail:"請填寫所有必填欄位",life:2500});return}if((o.question?.length||0)>200){d.add({severity:"warn",summary:"字數過長",detail:"問題最多 200 字",life:2500});return}if((o.answer?.length||0)>1e3){d.add({severity:"warn",summary:"字數過長",detail:"答案最多 1000 字",life:2500});return}try{if(m.value?._id){const{data:s}=await w.update(m.value._id,{...o});if(!s.success)throw new Error(s.message||"更新 FAQ 失敗");d.add({severity:"success",summary:"更新成功",detail:`FAQ「${o.question||"未命名"}」已更新`,life:3e3})}else{const{data:s}=await w.create({...o});if(!s.success)throw new Error(s.message||"新增 FAQ 失敗");d.add({severity:"success",summary:"新增成功",detail:`FAQ「${o.question||"未命名"}」已新增`,life:3e3})}u.value=!1,await V()}catch(s){const e=s.response?.data?.message||s.message||"操作失敗";d.add({severity:"error",summary:"儲存失敗",detail:e,life:3e3})}},D=async(s,e)=>{const r=s.visible;s.visible=e;try{const{data:i}=await w.update(s._id,{visible:e});if(!i.success)throw new Error(i.message||"更新狀態失敗");d.add({severity:"success",summary:"狀態已更新",detail:`「${s.question}」已${e?"上架":"下架"}`,life:2e3})}catch(i){s.visible=r;const y=i.response?.data?.message||i.message||"更新狀態失敗";d.add({severity:"error",summary:"更新失敗",detail:y,life:3e3})}};return(s,e)=>{const r=W,i=X,y=oe,c=se,M=te,T=ee,B=le,z=Z,E=H("ConfirmDialog");return K(),J("div",re,[l("div",ie,[e[10]||(e[10]=l("div",{class:"flex-1"},[l("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900"},"FAQ 管理"),l("p",{class:"text-sm sm:text-base text-gray-600 mt-1 sm:mt-2"},"管理所有常見問題項目")],-1)),a(r,{label:"新增 FAQ",icon:"pi pi-plus",severity:"primary",onClick:e[0]||(e[0]=t=>L()),id:"newFaqButton",size:"small",class:"w-full sm:w-auto"})]),a(y,{class:"shadow-sm"},{content:n(()=>[l("div",ne,[l("div",de,[e[11]||(e[11]=l("label",{for:"searchModules",class:"sr-only"},"搜尋FAQ",-1)),l("span",ue,[a(i,{id:"searchModules",name:"searchModules",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),modelModifiers:{trim:!0},placeholder:"搜尋標題、描述、分類...",class:"w-full"},null,8,["modelValue"])])]),l("div",me,[a(v(F),{id:"statusFilter",name:"statusFilter",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:A,optionLabel:"label",optionValue:"value",placeholder:"選擇狀態",showClear:"",class:"w-full"},null,8,["modelValue"])])])]),_:1}),a(y,{class:"shadow-sm"},{content:n(()=>[a(T,{loading:x.value,value:O.value,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"顯示第 {first} 到 {last} 項，共 {totalRecords} 項",responsiveLayout:"scroll",class:"p-datatable-sm"},{default:n(()=>[a(c,{field:"question",header:"問題",sortable:""},{body:n(({data:t})=>[l("div",ce,f(t.question),1)]),_:1}),a(c,{field:"answer",header:"答案",sortable:""},{body:n(({data:t})=>[l("p",pe,f(t.answer),1)]),_:1}),a(c,{field:"category",header:"分類",sortable:""},{body:n(({data:t})=>[l("span",null,f(t.category),1)]),_:1}),a(c,{field:"sortOrder",header:"排序",sortable:""},{body:n(({data:t})=>[l("span",null,f(t.sortOrder),1)]),_:1}),a(c,{field:"visible",header:"狀態",sortable:""},{body:n(({data:t})=>[l("div",ve,[a(v(k),{id:"visible",name:"visible",modelValue:t.visible,"onUpdate:modelValue":h=>D(t,h)},null,8,["modelValue","onUpdate:modelValue"]),a(M,{value:t.visible?"上架":"下架",severity:P(t.visible)},null,8,["value","severity"])])]),_:1}),a(c,{header:"操作",exportable:!1},{body:n(({data:t})=>[l("div",fe,[a(r,{icon:"pi pi-pencil",severity:"warning",text:"",size:"small",onClick:h=>Q(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["loading","value"])]),_:1}),a(z,{visible:u.value,"onUpdate:visible":e[9]||(e[9]=t=>u.value=t),header:m.value?"編輯 FAQ":"新增 FAQ",modal:"",class:"p-fluid w-[95vw] sm:w-[38rem] max-w-4xl",dismissableMask:!0},{footer:n(()=>[l("div",Ve,[a(r,{label:"取消",icon:"pi pi-times",text:"",class:"!px-4 !py-2",onClick:e[8]||(e[8]=t=>u.value=!1),id:"cancelFaqButton"}),a(r,{label:m.value?"更新":"新增",icon:"pi pi-check",class:"!px-5 !py-2 !bg-indigo-600 hover:!bg-indigo-700 !border-indigo-600",onClick:U},null,8,["label"])])]),default:n(()=>[l("div",ge,[l("div",be,[l("div",ye,[e[12]||(e[12]=l("label",{for:"question",class:"block text-sm font-medium text-gray-700 mb-1"},"問題（必填）",-1)),a(i,{id:"question",name:"question",modelValue:o.question,"onUpdate:modelValue":e[3]||(e[3]=t=>o.question=t),modelModifiers:{trim:!0},maxlength:200,required:"",placeholder:"最多 200 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),l("div",we,[e[13]||(e[13]=l("label",{for:"answer",class:"block text-sm font-medium text-gray-700 mb-1"},"答案（必填）",-1)),a(B,{id:"answer",name:"answer",modelValue:o.answer,"onUpdate:modelValue":e[4]||(e[4]=t=>o.answer=t),modelModifiers:{trim:!0},rows:"3",autoResize:"",maxlength:1e3,required:"",placeholder:"最多 1000 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),l("div",null,[e[14]||(e[14]=l("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-1"},"分類（必填）",-1)),a(v(F),{id:"category",name:"category",modelValue:o.category,"onUpdate:modelValue":e[5]||(e[5]=t=>o.category=t),options:$,optionLabel:"label",optionValue:"value",required:"",placeholder:"選擇分類",class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[15]||(e[15]=l("label",{for:"sortOrder",class:"block text-sm font-medium text-gray-700 mb-1"},"排序（選填）",-1)),a(v(ae),{id:"sortOrder",name:"sortOrder",modelValue:o.sortOrder,"onUpdate:modelValue":e[6]||(e[6]=t=>o.sortOrder=t),min:0,class:"w-full"},null,8,["modelValue"])]),l("div",xe,[e[16]||(e[16]=l("label",{for:"visible",class:"block text-sm font-medium text-gray-700 mb-2"},"狀態（必填）",-1)),l("div",_e,[a(v(k),{id:"visible",name:"visible",modelValue:o.visible,"onUpdate:modelValue":e[7]||(e[7]=t=>o.visible=t)},null,8,["modelValue"]),l("span",{class:Y(["text-xs px-2 py-1 rounded-md",o.visible?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},f(o.visible?"上架":"下架"),3)])])])])]),_:1},8,["visible","header"]),a(E)])}}};typeof C=="function"&&C(qe);export{qe as default};
