import{k as S,l as X,m as p,n as Q,p as G,c as H,q as J,g as K,a as k,o as C,b as s,d as i,s as W,w as n,v as Y,f as g,x as $,t as b,e as Z,y as O,z as ee,A as te}from"./index-D9obABGl.js";import{s as se,a as le,b as oe,d as ie,c as re}from"./index-CibE6ipL.js";import{s as ae}from"./index-BVHDUqWP.js";import{m as w}from"./modules-C73FYzBl.js";import{b as L}from"./route-block-B_A1xBdJ.js";import"./index-DUxQc-CO.js";const ne={class:"space-y-6"},de={class:"flex justify-between items-center"},ue={class:"flex gap-4 items-center"},me={class:"flex-1"},ce={class:"p-input-icon-left w-full"},pe={class:"font-medium line-clamp-2"},ge={class:"w-80 truncate"},be=["src","onClick"],fe={class:"flex items-center gap-2"},ve={class:"flex gap-2"},ye={class:"rounded-xl bg-white/60 backdrop-blur p-4 space-y-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},xe={class:"col-span-1 md:col-span-2"},_e={class:"col-span-1 md:col-span-2"},Ue={class:"col-span-1 md:col-span-2"},Ve={class:"col-span-1 md:col-span-2"},he={class:"flex items-center gap-3"},ke={class:"w-full flex items-center justify-between gap-3"},Ce={__name:"modules",setup($e){S();const d=X(),U=p([]),x=p(!1),f=p(""),v=p(null),u=p(!1),c=p(null),o=Q({title:"",description:"",category:"",imageUrl:"",sortOrder:0,visible:!0}),M=[{label:"上架",value:!0},{label:"下架",value:!1}],P=[{label:"前端基礎技術",value:"前端基礎技術"},{label:"前端框架與進階技術",value:"前端框架與進階技術"},{label:"後端開發與 API 串接",value:"後端開發與 API 串接"},{label:"資料庫設計與操作",value:"資料庫設計與操作"},{label:"版本控制與專案維運",value:"版本控制與專案維運"},{label:"UI/UX 設計",value:"UI/UX 設計"},{label:"作品製作與分享",value:"作品製作與分享"}];G(()=>{V()});const D=H(()=>{let l=U.value;if(f.value){const e=f.value.toLowerCase();l=l.filter(r=>(r.title||"").toLowerCase().includes(e)||(r.description||"").toLowerCase().includes(e)||(r.category||"").toLowerCase().includes(e))}return v.value!==null&&(l=l.filter(e=>e.visible===v.value)),[...l].sort((e,r)=>{const a=(e.sortOrder??0)-(r.sortOrder??0);return a!==0?a:new Date(r.createdAt)-new Date(e.createdAt)})});J(u,l=>{l||h()});const A=()=>{c.value=null,h(),u.value=!0},V=async()=>{x.value=!0;try{const{data:l}=await w.getAll();if(l.success)U.value=l.modules;else throw new Error(l.message||"從伺服器獲取模組資料失敗")}catch(l){const e=l.response?.data?.message||l.message||"無法取得模組資料";d.add({severity:"error",summary:"錯誤",detail:e,life:3e3})}finally{x.value=!1}},T=l=>l?"success":"secondary",h=()=>{Object.assign(o,{title:"",description:"",category:"",imageUrl:"",sortOrder:0,visible:!0})},j=l=>{l.imageUrl&&window.open(l.imageUrl,"_blank","noopener,noreferrer")},q=l=>{c.value=l,Object.assign(o,{...l}),u.value=!0},B=async()=>{if(!o.title?.trim()||!o.imageUrl?.trim()||!o.description?.trim()||!o.category?.trim()){d.add({severity:"warn",summary:"資料不足",detail:"請填寫所有必填欄位",life:2500});return}if(!(e=>{try{return new URL(e),!0}catch{return!1}})(o.imageUrl)){d.add({severity:"warn",summary:"格式錯誤",detail:"請提供正確的圖片網址格式",life:2500});return}if((o.title?.length||0)>100){d.add({severity:"warn",summary:"字數過長",detail:"標題最多 100 字",life:2500});return}if((o.description?.length||0)>300){d.add({severity:"warn",summary:"字數過長",detail:"描述最多 300 字",life:2500});return}try{if(c.value?._id){const{data:e}=await w.update(c.value._id,{...o});if(!e.success)throw new Error(e.message||"更新模組失敗");d.add({severity:"success",summary:"更新成功",detail:`模組「${o.title||"未命名"}」已更新`,life:3e3})}else{const{data:e}=await w.create({...o});if(!e.success)throw new Error(e.message||"新增模組失敗");d.add({severity:"success",summary:"新增成功",detail:`模組「${o.title||"未命名"}」已新增`,life:3e3})}u.value=!1,await V()}catch(e){const r=e.response?.data?.message||e.message||"操作失敗";d.add({severity:"error",summary:"儲存失敗",detail:r,life:3e3})}},I=async(l,e)=>{const r=l.visible;l.visible=e;try{const{data:a}=await w.update(l._id,{visible:e});if(!a.success)throw new Error(a.message||"更新狀態失敗");d.add({severity:"success",summary:"狀態已更新",detail:`「${l.title}」已${e?"上架":"下架"}`,life:2e3})}catch(a){l.visible=r;const y=a.response?.data?.message||a.message||"更新狀態失敗";d.add({severity:"error",summary:"更新失敗",detail:y,life:3e3})}};return(l,e)=>{const r=W,a=Y,y=ae,m=le,R=oe,E=se,F=re,z=te,N=K("ConfirmDialog");return C(),k("div",ne,[s("div",de,[e[11]||(e[11]=s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-900"},"課程模組管理"),s("p",{class:"text-gray-600 mt-2"},"管理所有課程模組項目")],-1)),i(r,{label:"新增模組",icon:"pi pi-plus",severity:"primary",onClick:e[0]||(e[0]=t=>A()),id:"newModuleButton"})]),i(y,{class:"shadow-sm"},{content:n(()=>[s("div",ue,[s("div",me,[e[12]||(e[12]=s("label",{for:"searchModules",class:"sr-only"},"搜尋模組",-1)),s("span",ce,[i(a,{id:"searchModules",name:"searchModules",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),modelModifiers:{trim:!0},placeholder:"搜尋標題、描述、分類...",class:"w-full"},null,8,["modelValue"])])]),s("div",null,[i(g($),{id:"statusFilter",name:"statusFilter",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),options:M,optionLabel:"label",optionValue:"value",placeholder:"選擇狀態",showClear:"",class:"w-48"},null,8,["modelValue"])])])]),_:1}),i(y,{class:"shadow-sm"},{content:n(()=>[i(E,{loading:x.value,value:D.value,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"顯示第 {first} 到 {last} 項，共 {totalRecords} 項",responsiveLayout:"scroll",class:"p-datatable-sm"},{default:n(()=>[i(m,{field:"title",header:"標題",sortable:""},{body:n(({data:t})=>[s("div",pe,b(t.title),1)]),_:1}),i(m,{field:"description",header:"描述",sortable:""},{body:n(({data:t})=>[s("p",ge,b(t.description),1)]),_:1}),i(m,{field:"category",header:"分類",sortable:""},{body:n(({data:t})=>[s("span",null,b(t.category),1)]),_:1}),i(m,{field:"sortOrder",header:"排序",sortable:""},{body:n(({data:t})=>[s("span",null,b(t.sortOrder),1)]),_:1}),i(m,{field:"imageUrl",header:"封面圖片",sortable:""},{body:n(({data:t})=>[t.imageUrl?(C(),k("img",{key:0,src:t.imageUrl,alt:"封面",class:"w-20 h-12 object-cover rounded shadow cursor-pointer",onClick:_=>j(t)},null,8,be)):Z("",!0)]),_:1}),i(m,{field:"visible",header:"狀態",sortable:""},{body:n(({data:t})=>[s("div",fe,[i(g(O),{id:"visible",name:"visible",modelValue:t.visible,"onUpdate:modelValue":_=>I(t,_)},null,8,["modelValue","onUpdate:modelValue"]),i(R,{value:t.visible?"上架":"下架",severity:T(t.visible)},null,8,["value","severity"])])]),_:1}),i(m,{header:"操作",exportable:!1},{body:n(({data:t})=>[s("div",ve,[i(r,{icon:"pi pi-pencil",severity:"warning",text:"",size:"small",onClick:_=>q(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["loading","value"])]),_:1}),i(z,{visible:u.value,"onUpdate:visible":e[10]||(e[10]=t=>u.value=t),header:c.value?"編輯模組":"新增模組",modal:"",class:"p-fluid",style:{width:"38rem"},pt:{content:{class:"max-h-[70dvh] overflow-y-auto"},footer:{class:"mt-4 sm:mt-6 pt-4 border-t border-gray-200/80 bg-white sticky bottom-0"}}},{footer:n(()=>[s("div",ke,[i(r,{label:"取消",icon:"pi pi-times",text:"",class:"!px-4 !py-2",onClick:e[9]||(e[9]=t=>u.value=!1),id:"cancelModuleButton"}),i(r,{label:c.value?"更新":"新增",icon:"pi pi-check",class:"!px-5 !py-2 !bg-indigo-600 hover:!bg-indigo-700 !border-indigo-600",onClick:B},null,8,["label"])])]),default:n(()=>[s("div",ye,[s("div",we,[s("div",xe,[e[13]||(e[13]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"}," 標題（必填） ",-1)),i(a,{id:"title",name:"title",modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.title=t),modelModifiers:{trim:!0},maxlength:100,required:"",placeholder:"最多 100 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",null,[e[14]||(e[14]=s("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-1"},"分類（必填）",-1)),i(g($),{id:"category",name:"category",modelValue:o.category,"onUpdate:modelValue":e[4]||(e[4]=t=>o.category=t),options:P,optionLabel:"label",optionValue:"value",required:"",placeholder:"選擇分類",class:"w-full"},null,8,["modelValue"])]),s("div",null,[e[15]||(e[15]=s("label",{for:"sortOrder",class:"block text-sm font-medium text-gray-700 mb-1"},"排序 (1) 數字越小越前 (2) 0為首頁顯示",-1)),i(g(ie),{id:"sortOrder",name:"sortOrder",modelValue:o.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=t=>o.sortOrder=t),min:0,class:"w-full [&_.p-inputnumber-input]:w-full [&_.p-inputnumber-input]:rounded-lg [&_.p-inputnumber-input]:border [&_.p-inputnumber-input]:border-gray-300 [&_.p-inputnumber-input]:text-sm [&_.p-inputnumber-input]:h-9 [&_.p-inputnumber-input:focus]:ring-2 [&_.p-inputnumber-input:focus]:ring-indigo-500 [&_.p-inputnumber-input:focus]:border-indigo-500"},null,8,["modelValue"])]),s("div",_e,[e[16]||(e[16]=s("label",{for:"imageUrl",class:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1"},[s("span",null,"封面圖片網址（必填）"),s("i",{class:"pi pi-info-circle text-gray-500",title:"建議 1200×675（16:9）"})],-1)),i(a,{id:"imageUrl",name:"imageUrl",modelValue:o.imageUrl,"onUpdate:modelValue":e[6]||(e[6]=t=>o.imageUrl=t),modelModifiers:{trim:!0},type:"url",required:"",placeholder:"https://example.com/cover.jpg",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",Ue,[e[17]||(e[17]=s("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"描述（必填）",-1)),i(F,{id:"description",name:"description",modelValue:o.description,"onUpdate:modelValue":e[7]||(e[7]=t=>o.description=t),modelModifiers:{trim:!0},rows:"2",autoResize:"",maxlength:300,required:"",placeholder:"最多 300 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",Ve,[e[18]||(e[18]=s("label",{for:"visible",class:"block text-sm font-medium text-gray-700 mb-2"},"狀態（必填）",-1)),s("div",he,[i(g(O),{id:"visible",name:"visible",modelValue:o.visible,"onUpdate:modelValue":e[8]||(e[8]=t=>o.visible=t)},null,8,["modelValue"]),s("span",{class:ee(["text-xs px-2 py-1 rounded-md",o.visible?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},b(o.visible?"上架":"下架"),3)])])])])]),_:1},8,["visible","header"]),i(N)])}}};typeof L=="function"&&L(Ce);export{Ce as default};
