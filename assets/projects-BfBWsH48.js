import{k as z,l as E,m as c,n as F,p as q,c as S,q as I,g as Q,a as G,o as H,b as s,d as i,s as J,w as d,v as K,f as v,x as W,t as y,j as X,y as k,z as Y,A as Z}from"./index-D9obABGl.js";import{s as ee,a as te,b as se,d as le,c as oe}from"./index-CibE6ipL.js";import{s as ie}from"./index-BVHDUqWP.js";import{p as x}from"./projects-D6lrdaTt.js";import{b as P}from"./route-block-B_A1xBdJ.js";import"./index-DUxQc-CO.js";const re={class:"space-y-6"},ae={class:"flex justify-between items-center"},ne={class:"flex gap-4 items-center"},de={class:"flex-1"},ue={class:"p-input-icon-left w-full"},me={class:"font-medium line-clamp-2"},ce={class:"w-80 truncate"},pe={class:"flex items-center gap-2"},fe={class:"flex gap-2"},ge={class:"rounded-xl bg-white/60 backdrop-blur p-4 space-y-4"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ve={class:"col-span-1 md:col-span-2"},ye={class:"col-span-1 md:col-span-2"},xe={class:"col-span-1 md:col-span-2"},we={class:"col-span-1 md:col-span-2"},_e={class:"col-span-1 md:col-span-2"},Ve={class:"flex items-center gap-3"},Ue={class:"w-full flex items-center justify-between gap-3"},he={__name:"projects",setup(ke){z();const n=E(),V=c([]),w=c(!1),f=c(""),g=c(null),u=c(!1),m=c(null),o=F({title:"",studentName:"",description:"",imageUrl:"",demoUrl:"",sortOrder:0,visible:!0}),C=[{label:"上架",value:!0},{label:"下架",value:!1}];q(()=>{U()});const $=S(()=>{let l=V.value;if(f.value){const e=f.value.toLowerCase();l=l.filter(r=>(r.title||"").toLowerCase().includes(e)||(r.studentName||"").toLowerCase().includes(e)||(r.description||"").toLowerCase().includes(e))}return g.value!==null&&(l=l.filter(e=>e.visible===g.value)),[...l].sort((e,r)=>{const a=(e.sortOrder??0)-(r.sortOrder??0);return a!==0?a:new Date(r.createdAt)-new Date(e.createdAt)})});I(u,l=>{l||h()});const j=()=>{m.value=null,h(),u.value=!0},U=async()=>{w.value=!0;try{const{data:l}=await x.getAll();if(l.success)V.value=l.projects;else throw new Error(l.message||"從伺服器獲取專題資料失敗")}catch(l){const e=l.response?.data?.message||l.message||"無法取得專題資料";n.add({severity:"error",summary:"錯誤",detail:e,life:3e3})}finally{w.value=!1}},h=()=>{Object.assign(o,{title:"",studentName:"",description:"",imageUrl:"",demoUrl:"",sortOrder:0,visible:!0})},L=l=>{l.demoUrl&&window.open(l.demoUrl,"_blank","noopener,noreferrer")},N=l=>{m.value=l,Object.assign(o,{...l}),u.value=!0},O=async()=>{if(!o.demoUrl?.trim()||!o.imageUrl?.trim()){n.add({severity:"warn",summary:"資料不足",detail:"請填寫「專題連結」與「封面圖片網址」",life:2500});return}const l=e=>{try{return new URL(e),!0}catch{return!1}};if(!l(o.demoUrl)||!l(o.imageUrl)){n.add({severity:"warn",summary:"格式錯誤",detail:"請提供正確的網址格式（含 http/https）",life:2500});return}if((o.title?.length||0)>100){n.add({severity:"warn",summary:"字數過長",detail:"標題最多 100 字",life:2500});return}if((o.description?.length||0)>1e3){n.add({severity:"warn",summary:"字數過長",detail:"描述最多 1000 字",life:2500});return}try{if(m.value?._id){const{data:e}=await x.update(m.value._id,{...o});if(!e.success)throw new Error(e.message||"更新專題失敗");n.add({severity:"success",summary:"更新成功",detail:`專題「${o.title||"未命名"}」已更新`,life:3e3})}else{const{data:e}=await x.create({...o});if(!e.success)throw new Error(e.message||"新增專題失敗");n.add({severity:"success",summary:"新增成功",detail:`專題「${o.title||"未命名"}」已新增`,life:3e3})}u.value=!1,await U()}catch(e){const r=e.response?.data?.message||e.message||"操作失敗";n.add({severity:"error",summary:"儲存失敗",detail:r,life:3e3})}},D=async(l,e)=>{const r=l.visible;l.visible=e;try{const{data:a}=await x.update(l._id,{visible:e});if(!a.success)throw new Error(a.message||"更新狀態失敗");n.add({severity:"success",summary:"狀態已更新",detail:`「${l.title}」已${e?"上架":"下架"}`,life:2e3})}catch(a){l.visible=r;const b=a.response?.data?.message||a.message||"更新狀態失敗";n.add({severity:"error",summary:"更新失敗",detail:b,life:3e3})}};return(l,e)=>{const r=J,a=K,b=ie,p=te,T=se,M=ee,A=oe,B=Z,R=Q("ConfirmDialog");return H(),G("div",re,[s("div",ae,[e[12]||(e[12]=s("div",null,[s("h1",{class:"text-3xl font-bold text-gray-900"},"學員專題管理"),s("p",{class:"text-gray-600 mt-2"},"管理學員專題展示項目")],-1)),i(r,{label:"新增專題",icon:"pi pi-plus",severity:"primary",onClick:e[0]||(e[0]=t=>j()),id:"newProjectButton"})]),i(b,{class:"shadow-sm"},{content:d(()=>[s("div",ne,[s("div",de,[e[13]||(e[13]=s("label",{for:"searchProjects",class:"sr-only"},"搜尋專題",-1)),s("span",ue,[i(a,{id:"searchProjects",name:"searchProjects",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),modelModifiers:{trim:!0},placeholder:"搜尋專題、學員...",class:"w-full"},null,8,["modelValue"])])]),s("div",null,[i(v(W),{id:"statusFilter",name:"statusFilter",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),options:C,optionLabel:"label",optionValue:"value",placeholder:"選擇狀態",showClear:"",class:"w-48"},null,8,["modelValue"])])])]),_:1}),i(b,{class:"shadow-sm"},{content:d(()=>[i(M,{loading:w.value,value:$.value,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"顯示第 {first} 到 {last} 項，共 {totalRecords} 項",responsiveLayout:"scroll",class:"p-datatable-sm"},{default:d(()=>[i(p,{field:"title",header:"專題名稱",sortable:""},{body:d(({data:t})=>[s("div",me,y(t.title),1)]),_:1}),i(p,{field:"description",header:"描述",sortable:""},{body:d(({data:t})=>[s("p",ce,y(t.description),1)]),_:1}),i(p,{field:"studentName",header:"學員",sortable:""},{body:d(({data:t})=>[X(y(t.studentName),1)]),_:1}),i(p,{field:"visible",header:"狀態",sortable:""},{body:d(({data:t})=>[s("div",pe,[i(v(k),{id:"visible",name:"visible",modelValue:t.visible,"onUpdate:modelValue":_=>D(t,_)},null,8,["modelValue","onUpdate:modelValue"]),i(T,{value:t.visible?"上架":"下架",severity:t.visible?"success":"secondary"},null,8,["value","severity"])])]),_:1}),i(p,{header:"操作",exportable:!1},{body:d(({data:t})=>[s("div",fe,[i(r,{icon:"pi pi-eye",severity:"info",text:"",size:"small",onClick:_=>L(t)},null,8,["onClick"]),i(r,{icon:"pi pi-pencil",severity:"warning",text:"",size:"small",onClick:_=>N(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["loading","value"])]),_:1}),i(B,{visible:u.value,"onUpdate:visible":e[11]||(e[11]=t=>u.value=t),header:m.value?"編輯專題":"新增專題",modal:"",class:"p-fluid",style:{width:"38rem"},pt:{content:{class:"max-h-[70dvh] overflow-y-auto"},footer:{class:"mt-4 sm:mt-6 pt-4 border-t border-gray-200/80 bg-white sticky bottom-0"}}},{footer:d(()=>[s("div",Ue,[i(r,{label:"取消",icon:"pi pi-times",text:"",class:"!px-4 !py-2",onClick:e[10]||(e[10]=t=>u.value=!1),id:"cancelProjectButton"}),i(r,{label:m.value?"更新":"新增",icon:"pi pi-check",class:"!px-5 !py-2 !bg-indigo-600 hover:!bg-indigo-700 !border-indigo-600",onClick:O},null,8,["label"])])]),default:d(()=>[s("div",ge,[s("div",be,[s("div",ve,[e[14]||(e[14]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"}," 專題名稱（選填） ",-1)),i(a,{id:"title",name:"title",modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.title=t),modelModifiers:{trim:!0},maxlength:100,placeholder:"最多 100 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",null,[e[15]||(e[15]=s("label",{for:"studentName",class:"block text-sm font-medium text-gray-700 mb-1"},"學員姓名（選填）",-1)),i(a,{id:"studentName",name:"studentName",modelValue:o.studentName,"onUpdate:modelValue":e[4]||(e[4]=t=>o.studentName=t),modelModifiers:{trim:!0},class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",null,[e[16]||(e[16]=s("label",{for:"sortOrder",class:"block text-sm font-medium text-gray-700 mb-1"},"排序（數字越小越前）（選填）",-1)),i(v(le),{id:"sortOrder",name:"sortOrder",modelValue:o.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=t=>o.sortOrder=t),min:0,class:"w-full [&_.p-inputnumber-input]:w-full [&_.p-inputnumber-input]:rounded-lg [&_.p-inputnumber-input]:border [&_.p-inputnumber-input]:border-gray-300 [&_.p-inputnumber-input]:text-sm [&_.p-inputnumber-input]:h-9 [&_.p-inputnumber-input:focus]:ring-2 [&_.p-inputnumber-input:focus]:ring-indigo-500 [&_.p-inputnumber-input:focus]:border-indigo-500"},null,8,["modelValue"])]),s("div",ye,[e[17]||(e[17]=s("label",{for:"imageUrl",class:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-1"},[s("span",null,"封面圖片網址（必填）"),s("i",{class:"pi pi-info-circle text-gray-500",title:"建議 1200×675（16:9）"})],-1)),i(a,{id:"imageUrl",name:"imageUrl",modelValue:o.imageUrl,"onUpdate:modelValue":e[6]||(e[6]=t=>o.imageUrl=t),modelModifiers:{trim:!0},type:"url",required:"",placeholder:"https://example.com/cover.jpg",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",xe,[e[18]||(e[18]=s("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"專題描述（選填）",-1)),i(A,{id:"description",name:"description",modelValue:o.description,"onUpdate:modelValue":e[7]||(e[7]=t=>o.description=t),modelModifiers:{trim:!0},rows:"2",autoResize:"",maxlength:1e3,placeholder:"最多 1000 字",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",we,[e[19]||(e[19]=s("label",{for:"demoUrl",class:"block text-sm font-medium text-gray-700 mb-1"},"專題連結（必填）",-1)),i(a,{id:"demoUrl",modelValue:o.demoUrl,"onUpdate:modelValue":e[8]||(e[8]=t=>o.demoUrl=t),modelModifiers:{trim:!0},type:"url",required:"",placeholder:"https://example.com/demo",class:"p-inputtext-sm text-sm w-full rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,8,["modelValue"])]),s("div",_e,[e[20]||(e[20]=s("label",{for:"visible",class:"block text-sm font-medium text-gray-700 mb-2"},"狀態（必填）",-1)),s("div",Ve,[i(v(k),{id:"visible",name:"visible",modelValue:o.visible,"onUpdate:modelValue":e[9]||(e[9]=t=>o.visible=t)},null,8,["modelValue"]),s("span",{class:Y(["text-xs px-2 py-1 rounded-md",o.visible?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"])},y(o.visible?"上架":"下架"),3)])])])])]),_:1},8,["visible","header"]),i(R)])}}};typeof P=="function"&&P(he);export{he as default};
